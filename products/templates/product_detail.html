{% extends "base/base.html" %}
{% load static %}
{% block title %}
<title>product</title>
{% endblock title  %}

{% block content %}

<section class="py-12 md:py-14 bg-black">
    <div class="container mx-auto px-4">
      <div class="max-w-md md:max-w-none mx-auto">
        <ul class="flex items-center">
          <li class="mr-3">
            <a class="text-gray-400 font-medium" href="#">Home</a>
            <span class="pl-2 text-gray-400">/</span>
          </li>
          <li class="mr-3">
            <a class="text-gray-400 font-medium" href="#">Fashion</a>
            <span class="pl-2 text-gray-400">/</span>
          </li>
          <li><a class="text-yellow-500 font-medium" href="#">{{product.name}}</a></li>
        </ul>
        <div class="flex flex-wrap mt-10 -mx-4">
          <div class="w-full md:w-1/2 lg:w-3/5  mb-12 md:mb-0 px-4">
            <div class="max-w-3xl">
              <div class="lg:flex h-full">
                <div class="lg:flex-shrink-0 lg:w-20 lg:mr-6">
                  <div class="flex lg:-mb-4 lg:block justify-between">
                    <a class="block mb-4" href="#">
                      <img class="block sm:w-20 h-20" src="{% static 'assets/images/product-details/clothes1.png' %}" alt="">
                    </a>
                    <a class="block mb-4" href="#">
                      <img class="block sm:w-20 h-20" src="{% static 'assets/images/product-details/clothes2.png' %}" alt="">
                    </a>
                    <a class="block mb-4" href="#">
                      <img class="block sm:w-20 h-20" src="{% static 'assets/images/product-details/clothes3.png' %}" alt="">
                    </a>
                    <a class="block mb-4" href="#">
                      <img class="block sm:w-20 h-20" src="{% static 'assets/images/product-details/clothes4.png' %}" alt="">
                    </a>
                  </div>
                </div>
                <div>
                  <img class="block h-full w-full max-w-4xl" src="{% static 'assets/images/product-details/clothes-big-1.png' %}" alt="">
                </div>
              </div>
            </div>
          </div>
          <div class="w-full md:w-1/2 lg:w-2/5  px-4">
            <div class="p-8 h-full border border-blueGray-800">
              <div class="pb-8 border-b border-blueGray-800">
                <span class="inline-block px-2 text-sm mb-5 bg-yellow-500 font-medium rounded-full">Hot</span>
                <h4 class="font-heading font-bold text-2xl text-white mb-3">{{product.name}}</h4>
                <!--<p class="text-gray-400 mb-6">Lorem ipsum dolor sit amet, consectetur adipiscing a elit. Nullam to the dictum aliquet accum.</p>-->
                <span class="block mb-1 text-gray-500 font-medium line-through">4500 DZD</span>
                <div class="inline-flex items-end">
                  <h4 class="text-2xl font-bold text-white mr-4">{{product.price}} DZD</h4>
                  <span class="text-yellow-500">%25 OFF</span>
                </div>
              </div>
              <div class="pt-8 pb-8 ">
                <div class="w-full">
                  <form method="POST">
                    {% csrf_token %}
                    {{ form.non_field_errors }}

                  <div class="flex flex-wrap flex-row-reverse -mx-2 mb-6">
                    
                    <div class="w-full md:w-1/2 px-2 mb-6 md:mb-0 ">
                        {{ form.first_name.errors }}
                        {{ form.first_name }}
                    </div>

                    <div class="w-full md:w-1/2 px-2">
                      {{ form.last_name.errors }}
                      {{ form.last_name }}
                   </div>

                  </div>

                  <div class="flex flex-wrap flex-row-reverse -mx-2 mb-6">
                   
                    <div class="w-full md:w-1/2 px-2 mb-6 md:mb-0">
                      {{ form.state.errors }}
                      {{ form.state }}
                    </div>

                    <div class="w-full md:w-1/2 px-2 ">

                      {{ form.city.errors }}
                      {{ form.city }}
                    </div>
                  </div>

                    <div class="mb-6">
                        {{ form.full_adress.errors }}
                        {{ form.full_adress }}
                    </div>
                    
                    <div class="mb-6">
                      {% if form.phone_number.errors %}
                      {% for error in form.phone_number.errors %}
                        <p class="text-yellow-500 mb-2">{{ error }}</p>
                      {% endfor %}
                      {% endif %}
                      {{ form.phone_number }}
                    </div>
            
                    <div class="mb-6">
                      {{ form.quantity.errors }}
                      <div class="flex items-center">
                        <button class="rounded-full w-8 h-8 bg-gray-300 text-lg text-gray-600 focus:outline-none" type="button" id="minus-btn">-</button>
                        {{ form.quantity }}
                        <button class="rounded-full w-8 h-8 bg-gray-300 text-lg text-gray-600 focus:outline-none" type="button" id="plus-btn">+</button>
                      </div>
                   </div>
                   <!-- recap-->
                   <div class="p-8">
                    <div class="flex mb-5 items-center justify-between">
                      <span class="text-sm font-medium text-gray-400">Subtotal</span>
                      <span class="text-sm font-medium text-white"></span>
                    </div>
                    <div class="flex mb-5 items-center justify-between">
                      <span class="text-sm font-medium text-gray-400">Shipping</span>
                      <span class="text-sm font-medium text-white" id="state_fee"></span>
                    </div>
                    
                    <div class="flex mb-8 items-center justify-between">
                      <span class="text-sm font-bold text-white">Total To pay</span>
                      <span class="text-sm font-bold text-white" id="order-total"></span>
                    </div>
                  </div>
                   <button type="submit" class="w-full inline-block px-12 py-4 text-center text-black font-bold bg-yellow-500 hover:bg-yellow-600 transition duration-200"> order</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>



{% endblock content %}

{% block scripts  %}
<script>

  const stateFeeData = {
        {% for fee in fees %}
        "{{ fee.wilaya.id }}":{{ fee.home_fee }} ,
        {% endfor %}
    };

    const stateCityData = {
        {% for state in states %}
        "{{ state.id }}": [
            {% for city in state.commune_set.all %}
            { "id": "{{ city.id }}", "name": "{{ city.display_name }}" },
            {% endfor %}
        ],
        {% endfor %}
    };

    const stateSelect = document.querySelector('#id_state');
    const citySelect = document.querySelector('#id_city');
    const stateFee = document.querySelector('#state_fee');

    stateSelect.addEventListener('change', () => {
        const selectedState = stateSelect.value;
        if (selectedState) {
            populateCityOptions(selectedState);
            updateStateFee(selectedState)
            updateOrderTotal();
        } else {
            clearCityOptions();
        }
    });

    $("#plus-btn").click(function() {
      var quantityField = $("#id_quantity");
      var currentValue = parseInt(quantityField.val());
      quantityField.val(currentValue + 1);
      updateOrderTotal();
    });

    // Function to decrease the quantity, minimum value is 1
    $("#minus-btn").click(function() {
      var quantityField = $("#id_quantity");
      var currentValue = parseInt(quantityField.val());
      if (currentValue > 1) {
        quantityField.val(currentValue - 1);
        updateOrderTotal();
      }
    });

    

    function updateOrderTotal() {
      var quantity = parseInt($("#id_quantity").val());
      var productPrice = {{product.price}};
      var shippingCost = parseFloat($("#state_fee").text());

      var orderTotal = (quantity * productPrice) + shippingCost;

      $("#order-total").text(orderTotal.toFixed(2));
    }

    function populateCityOptions(stateId) {
        const cities = stateCityData[stateId];
        citySelect.innerHTML = '<option value="" selected="">البلدية</option>';
        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city.id;
            option.text = city.name;
            citySelect.appendChild(option);
        });
    }

    function clearCityOptions() {
        citySelect.innerHTML = '<option value="">Select a state first</option>';
    }

    function updateStateFee(stateId) {
      stateFee.innerHTML = stateFeeData[stateId];
    }


</script>
{% endblock %}